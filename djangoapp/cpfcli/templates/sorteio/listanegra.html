{% extends 'index.html' %}
{% load static %}
{% block title %}{{title}}{% endblock %}

{% block content %}
    <div class="container-fluid vh-75 d-flex flex-start flex-wrap">
        <div class="container-fluid">
            {% include 'partials/message.html' %}
            <div class="mt-3 table-responsive">
                <table class="table tableSearch table-primary table-hover table-striped">
                    <thead>
                        <tr>
                            <th class="text-start">CÓDIGO CAMPANHA</th>
                            <th class="text-start">CODCLI</th>
                            <th class="text-start">NOME</th>
                            <th class="text-start">EMAIL</th>
                            <th class="text-start">CPF_CNPJ</th>
                            <th class="text-start">DATA CADASTRO</th>
                            <th class="text-start">AÇÕES</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for dado in listclis %}
                            <tr>
                                <td class="text-start">{{dado.IDCAMPANHA}}</td>
                                <td class="text-start">{{dado.CODCLI}}</td>
                                <td class="text-start">{{dado.NOMECLI}}</td>
                                <td class="text-start">{{dado.EMAIL}}</td>
                                <td class="text-start">{{dado.CPFCNPJ}}</td>
                                <td class="text-start">{{dado.DTMOV}}</td>
                                <td class="text-start col-2">
                                    <button 
                                        type="button" 
                                        class="btn btn-danger btn-sm delete-btn"
                                        data-idcampanha="{{dado.IDCAMPANHA}}"
                                        data-codcli="{{dado.CODCLI}}"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteModal">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

                {% include 'partials/components/insertmodal.html' %}
            </div>
        </div>
    </div> 

    <!-- Modal de deletar -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form class="modal-content needs-validation" method="POST">
                {% csrf_token %}
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">Deletar Cliente</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body modal-body1 d-flex justify-content-start flex-wrap">
                        <input type="hidden" name="codcli" id="codcli"/>
                        <input type="hidden" name="idcampanha" id="idcampanha"/>
                        <input type="hidden" name="nomecli" id="nomecli"/>
                        <div class="text-center w-100 mt-5 mb-4">
                            <i class="fa-solid fa-circle-xmark fa-6x " style="color: Tomato;"></i>
                        </div>
                        <div class="text-center w-100 mb-3">
                            <h4 class="modal-title">Você tem certeza?</h4>
                        </div>
                        <div class="form-group">
                            <p class="text-center">Deseja realmente deletar o cliente da blacklist desta campanha?</p>
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-center flex-nowrap">
                        <button type="button" class="btn btn-secondary col-6" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" name="delete" class="btn btn-danger col-6">Deletar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var deleteModal = document.getElementById('deleteModal');
            deleteModal.addEventListener('show.bs.modal', function (event) {
                var button = event.relatedTarget;
                var codcli = button.getAttribute('data-codcli');
                var idcampanha = button.getAttribute('data-idcampanha');
                var nome = button.getAttribute('data-nome');

                var modalCodcli = deleteModal.querySelector('#codcli');
                var modalIdcampanha = deleteModal.querySelector('#idcampanha');
                var modalnomecli = deleteModal.querySelector('#nomecli');
                var modalTitle = deleteModal.querySelector('.modal-title');

                modalCodcli.value = codcli;
                modalIdcampanha.value = idcampanha;
                modalnomecli.value = nome;
                modalTitle.textContent = 'Deletar ' + nome + ' da campanha ' + idcampanha;
            });
        });
    </script>
{% endblock %}
